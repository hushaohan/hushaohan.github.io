name: Update Github Pages
on:
  push:
    branches:
      - master
jobs:
  update_github_pages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout gh-pages branch
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          ref: gh-pages
      - name: Update gh-pages branch
        run: |
          git config --global user.email "hushaohan@gmail.com"
          git config --global user.name "Shaohan Hu"
          git pull origin master
      - name: Check if gh-pages root has a cv.pdf
        id: cv_pdf_exists
        uses: andstor/file-existence-action@v1
        with:
          files: "./cv.pdf"
      - name: Check cv directory for changes
        uses: dorny/paths-filter@v2
        id: cv_has_changes
        with:
          filters: |
            cv:
              - 'cv/**'
      - name: Compile cv
        if: steps.cv_has_changes.outputs.cv == 'true' || steps.cv_pdf_exists.outputs.files_exists == 'false'
        uses: xu-cheng/latex-action@v2
        with:
          working_directory: cv/
          root_file: cv.tex
      - name: Check cv.pdf
        if: steps.cv_has_changes.outputs.cv == 'true' || steps.cv_pdf_exists.outputs.files_exists == 'false'
        run: |
          file cv/cv.pdf | grep -q ' PDF '
      - name: Add cv.pdf
        if: steps.cv_has_changes.outputs.cv == 'true' || steps.cv_pdf_exists.outputs.files_exists == 'false'
        run: |
          git add cv/cv.pdf
          git mv cv/cv.pdf ./
          git commit -m "deploy cv.pdf"
      - name: Push gh-pages branch
        run: |
          # # configure git
          # git config --global user.email "hushaohan@gmail.com"
          # git config --global user.name "Shaohan Hu"
          git push
